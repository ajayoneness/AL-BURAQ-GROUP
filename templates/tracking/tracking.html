{% extends 'base.html' %}
{% load static i18n %}

{% block title %}{% trans "Track Your Shipment" %} - AL BURAQ GROUP{% endblock %}

{% block content %}
<!-- Hero -->
<section
    style="padding: 150px 0 80px; background: linear-gradient(180deg, var(--bg-darker) 0%, var(--bg-dark) 100%); position: relative; overflow: hidden;">
    <div class="container text-center">
        <h1 class="mb-md" data-aos="fade-up">{% trans "Track Your" %} <span class="text-gold">
            {% trans "Shipment" %}</span></h1>
        <p style="color: var(--text-secondary); max-width: 600px; margin: 0 auto;" data-aos="fade-up"
            data-aos-delay="100">
            {% trans "Enter your tracking number to get real-time updates on your shipment" %}
        </p>
    </div>
    <i class="fas fa-shipping-fast"
        style="position: absolute; right: -100px; bottom: -50px; font-size: 350px; opacity: 0.03; color: var(--gold-primary);"></i>
</section>

<!-- Tracking Form -->
<section class="section">
    <div class="container" style="max-width: 800px;">
        <div class="card card-glass" style="padding: 3rem;" data-aos="fade-up">
            <form id="trackingForm" action="" method="GET">
                <div class="flex gap-md" style="flex-wrap: wrap;">
                    <input type="text" id="trackingInput" name="tracking" class="form-control"
                        placeholder="{% trans 'Enter tracking number...' %}" value="{{ tracking_number }}"
                        style="flex: 1; font-size: 1.1rem; padding: 1rem 1.5rem;" required>
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-search"></i> {% trans "Track" %}
                    </button>
                </div>
            </form>
        </div>

        <!-- Results -->
        <div id="trackingResults" style="margin-top: 2rem;">
            {% if error %}
            <div class="alert alert-error" data-aos="fade-up">
                <i class="fas fa-exclamation-circle"></i> {{ error }}
            </div>
            {% endif %}

            {% if shipment %}
            <div class="card card-glass" style="padding: 2rem;" data-aos="fade-up">
                <div class="flex justify-between items-center mb-lg" style="flex-wrap: wrap; gap: 1rem;">
                    <div>
                        <h3 style="color: var(--gold-light);">
                            {% if shipment.shipping_method == 'air' %}
                            <i class="fas fa-plane"></i>
                            {% elif shipment.shipping_method == 'sea' %}
                            <i class="fas fa-ship"></i>
                            {% else %}
                            <i class="fas fa-train"></i>
                            {% endif %}
                            {{ shipment.tracking_number }}
                        </h3>
                        <p style="color: var(--text-secondary);">{{ shipment.get_shipping_method_display }}</p>
                    </div>
                    <div
                        class="badge {% if shipment.get_status_percentage >= 75 %}badge-success{% else %}badge-gold{% endif %}">
                        {{ shipment.get_current_status_display }}
                    </div>
                </div>

                <!-- Progress bar -->
                <div
                    style="background: var(--bg-card); border-radius: 10px; height: 8px; margin-bottom: 2rem; overflow: hidden;">
                    <div
                        style="background: var(--gold-gradient); height: 100%; width: {{ shipment.get_status_percentage }}%; transition: width 1s ease;">
                    </div>
                </div>

                <!-- Route info -->
                <div class="flex justify-between mb-lg" style="flex-wrap: wrap; gap: 1rem;">
                    <div>
                        <p style="color: var(--text-muted); font-size: 0.85rem;">{% trans "From" %}</p>
                        <p style="font-weight: 600;"><i class="fas fa-map-marker-alt"
                                style="color: var(--gold-light);"></i> {{ shipment.origin }}</p>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <i class="fas fa-arrow-right" style="color: var(--gold-light); font-size: 1.5rem;"></i>
                    </div>
                    <div style="text-align: right;">
                        <p style="color: var(--text-muted); font-size: 0.85rem;">{% trans "To" %}</p>
                        <p style="font-weight: 600;"><i class="fas fa-map-marker-alt" style="color: var(--teal);"></i>
                            {{ shipment.destination }}</p>
                    </div>
                </div>

                <!-- Details -->
                <div class="grid grid-cols-3 gap-lg mb-xl">
                    {% if shipment.estimated_delivery %}
                    <div class="card" style="padding: 1rem; text-align: center;">
                        <p style="color: var(--text-muted); font-size: 0.8rem;">{% trans "Est. Delivery" %}</p>
                        <p style="font-weight: 600; color: var(--teal);">{{ shipment.estimated_delivery }}</p>
                    </div>
                    {% endif %}
                    <div class="card" style="padding: 1rem; text-align: center;">
                        <p style="color: var(--text-muted); font-size: 0.8rem;">{% trans "Packages" %}</p>
                        <p style="font-weight: 600;">{{ shipment.total_packages }}</p>
                    </div>
                    {% if shipment.total_weight %}
                    <div class="card" style="padding: 1rem; text-align: center;">
                        <p style="color: var(--text-muted); font-size: 0.8rem;">{% trans "Weight" %}</p>
                        <p style="font-weight: 600;">{{ shipment.total_weight }} kg</p>
                    </div>
                    {% endif %}
                </div>

                <!-- Timeline -->
                <h4 class="mb-lg">{% trans "Tracking History" %}</h4>
                <div class="tracking-timeline">
                    {% for update in shipment.updates.all %}
                    <div
                        style="display: flex; gap: 1rem; {% if not forloop.last %}padding-bottom: 1.5rem; border-left: 2px solid var(--gold-primary); margin-left: 9px; padding-left: 1.5rem;{% endif %}">
                        <div
                            style="width: 20px; height: 20px; background: var(--gold-gradient); border-radius: 50%; flex-shrink: 0; {% if not forloop.last %}margin-left: -2.1rem;{% endif %}">
                        </div>
                        <div>
                            <p style="font-weight: 600;">{{ update.get_status_display }}</p>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">{{ update.description }}</p>
                            <p style="color: var(--text-muted); font-size: 0.8rem;">{{ update.timestamp|date:"Y-m-d H:i"
                                }}{% if update.location %} - {{ update.location }}{% endif %}</p>
                        </div>
                    </div>
                    {% empty %}
                    <p style="color: var(--text-muted);">{% trans "No tracking updates yet." %}</p>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Help Section -->
<section class="section" style="background: var(--bg-darker);">
    <div class="container">
        <div class="grid grid-cols-3 gap-xl">
            <div class="card card-glass text-center" style="padding: 2rem;" data-aos="fade-up">
                <i class="fas fa-question-circle"
                    style="font-size: 3rem; color: var(--gold-light); margin-bottom: 1rem;"></i>
                <h4 class="mb-sm">{% trans "Lost Tracking Number?" %}</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">{% trans "Contact our support team and we'll help you find your shipment." %}</p>
            </div>

            <div class="card card-glass text-center" style="padding: 2rem;" data-aos="fade-up" data-aos-delay="100">
                <i class="fas fa-clock" style="font-size: 3rem; color: var(--teal); margin-bottom: 1rem;"></i>
                <h4 class="mb-sm">{% trans "Delivery Delays?" %}</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">{% trans "Reach out to us for updates on any delayed shipments." %}</p>
            </div>

            <div class="card card-glass text-center" style="padding: 2rem;" data-aos="fade-up" data-aos-delay="200">
                <i class="fas fa-headset" style="font-size: 3rem; color: var(--purple); margin-bottom: 1rem;"></i>
                <h4 class="mb-sm">{% trans "Need Assistance?" %}</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">{% trans "Our team is available 24/7 to help you." %}</p>
                <a href="https://wa.me/{{ COMPANY_WHATSAPP|slice:'1:' }}" class="btn btn-primary btn-sm">
                    <i class="fab fa-whatsapp"></i> {% trans "Contact Us" %}
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}